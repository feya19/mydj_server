<!-- Custom rules for mydj_server security monitoring -->
<!-- Based on the attack scenarios in the project documentation -->

<group name="mydj_custom_rules">

  <!-- Rule 100001: SQL Injection Detection -->
  <rule id="100001" level="12">
    <decoded_as>json</decoded_as>
    <field name="message">SQL injection</field>
    <description>SQL Injection attempt detected on mydj_server</description>
    <group>web,sql_injection,attack</group>
  </rule>

  <rule id="100002" level="12">
    <regex>(\%27)|(\')|(\-\-)|(\%23)|(#)|(\%2D)|(\%2F)|(\/)|(\%5C)|(\%60)|(`)|(\%22)|(\")|(\%3C)|(<)|(\%3E)|(>)|(\%3D)|(=)|(\%7C)|(\|)|(\%28)|(\()|(\%29)|(\))|(\%7B)|(\{)|(\%7D)|(\})|(\%5B)|(\[)|(\%5D)|(\])|(\%2B)|(\+)|(\%25)|(\%)|(\%00)|(\x00)|(\%3B)|(;)</regex>
    <description>SQL Injection payload patterns detected</description>
    <group>web,sql_injection,attack</group>
  </rule>

  <!-- Rule 100003: API Rate Limit Exceeded -->
  <rule id="100003" level="8">
    <decoded_as>json</decoded_as>
    <field name="status_code">429</field>
    <description>API Rate limit exceeded - Possible DoS attempt</description>
    <group>web,dos,attack</group>
  </rule>

  <!-- Rule 100004: Multiple Failed Authentication (Brute Force) -->
  <rule id="100004" level="10" frequency="5" timeframe="120">
    <decoded_as>json</decoded_as>
    <field name="event_type">authentication_failed</field>
    <description>Multiple failed login attempts - Brute force attack detected</description>
    <group>authentication_failures,brute_force,attack</group>
  </rule>

  <!-- Rule 100005: Port Scanning Detection -->
  <rule id="100005" level="7">
    <regex>nmap|masscan|zmap|unicornscan</regex>
    <description>Port scanning activity detected</description>
    <group>reconnaissance,port_scan,attack</group>
  </rule>

  <!-- Rule 100006: Suspicious User-Agent -->
  <rule id="100006" level="6">
    <decoded_as>json</decoded_as>
    <field name="user_agent">sqlmap|nikto|dirb|gobuster|wfuzz|burp|acunetix</field>
    <description>Suspicious security scanner detected</description>
    <group>web,reconnaissance,attack</group>
  </rule>

  <!-- Rule 100007: High Frequency API Calls (DoS Detection) -->
  <rule id="100007" level="8" frequency="100" timeframe="60">
    <decoded_as>json</decoded_as>
    <field name="endpoint">/upload-jurnal</field>
    <description>High frequency API calls detected - Possible DoS attack</description>
    <group>web,dos,flooding,attack</group>
  </rule>

  <!-- Rule 100008: File Upload Attacks -->
  <rule id="100008" level="10">
    <decoded_as>json</decoded_as>
    <regex>\.php$|\.jsp$|\.asp$|\.aspx$|\.exe$|\.bat$|\.sh$|\.py$</regex>
    <description>Malicious file upload attempt detected</description>
    <group>web,upload,attack</group>
  </rule>

  <!-- Rule 100009: SSH Brute Force -->
  <rule id="100009" level="10" frequency="5" timeframe="300">
    <regex>Failed password|Failed publickey|authentication failure</regex>
    <description>SSH Brute force attack detected</description>
    <group>ssh,brute_force,attack</group>
  </rule>

  <!-- Rule 100010: Large Payload Upload -->
  <rule id="100010" level="7">
    <decoded_as>json</decoded_as>
    <field name="payload_size" type="pcre2">[1-9][0-9]{7,}</field>
    <description>Unusually large payload detected - Possible DoS attempt</description>
    <group>web,dos,attack</group>
  </rule>

</group>